class FichaDB { constructor() { this.db = null; this.storeName = 'fichas'; this.dbName = 'FichasObservacionDB'; } async init() { return new Promise((resolve, reject) => { const req = indexedDB.open(this.dbName, 1); req.onerror = () => reject(req.error); req.onsuccess = () => { this.db = req.result; resolve(); }; req.onupgradeneeded = (e) => { const db = e.target.result; if (!db.objectStoreNames.contains(this.storeName)) { db.createObjectStore(this.storeName, { keyPath: 'id', autoIncrement: true }); } }; }); } async guardar(datos) { return new Promise((resolve, reject) => { const tx = this.db.transaction([this.storeName], 'readwrite'); const store = tx.objectStore(this.storeName); datos.fechaCreacion = new Date().toISOString(); const req = store.add(datos); req.onsuccess = () => resolve(req.result); req.onerror = () => reject(req.error); }); } async obtenerTodos() { return new Promise((resolve, reject) => { const tx = this.db.transaction([this.storeName], 'readonly'); const store = tx.objectStore(this.storeName); const req = store.getAll(); req.onsuccess = () => resolve(req.result); req.onerror = () => reject(req.error); }); } async obtener(id) { return new Promise((resolve, reject) => { const tx = this.db.transaction([this.storeName], 'readonly'); const store = tx.objectStore(this.storeName); const req = store.get(id); req.onsuccess = () => resolve(req.result); req.onerror = () => reject(req.error); }); } async actualizar(id, datos) { return new Promise((resolve, reject) => { const tx = this.db.transaction([this.storeName], 'readwrite'); const store = tx.objectStore(this.storeName); datos.id = id; datos.fechaActualizacion = new Date().toISOString(); const req = store.put(datos); req.onsuccess = () => resolve(req.result); req.onerror = () => reject(req.error); }); } async eliminar(id) { return new Promise((resolve, reject) => { const tx = this.db.transaction([this.storeName], 'readwrite'); const store = tx.objectStore(this.storeName); const req = store.delete(id); req.onsuccess = () => resolve(true); req.onerror = () => reject(req.error); }); } } const fichaDB = new FichaDB();
